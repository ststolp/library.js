<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Receipt</title>
    <script type="text/javascript" src="/js/libraryjs.js"> </script>
    <script type="text/javascript">
    function getParams() {
        let url = location.search.substring(1);
        console.log("The url: " + url);
        let variables = url.split('&');
        console.log("The var: " + variables[0]);
        for (let i = 0; i < variables.length; i++) {
            //request each book individually. 
            let book_id = variables[i].split('=');
            console.log("The id: " + book_id[1]);
            target = `/get_checked?book=${book_id[1]}`;
            let request = new XMLHttpRequest();
            request.open("GET", target);
            request.send(); 
            console.log("sending request...");
            let divBooks = document.getElementById('output');
            request.onreadystatechange = function(){
		        console.log("on ready state function calling: " + request.readyState);
		        if(request.readyState == 4){
			        var div = document.createElement('div');
			    if(request.status == 200){
                    let array = JSON.parse(request.responseText);
                    let books = "";
                    array.forEach(function(item) {
                      let entry = `<p><b>${item.book_title}</b> loaned on ${item.checked_out}</p>`;
                      entry += `<p>Due date ${item.due_date}</p>`;
                      books = books + entry;
                    });
                divBooks.innerHTML = books;
				    //div.appendChild(document.createTextNode(JSON.stringify(ERROR)));
                }
              //  divBooks.innerHTML = "";
			    //divBooks.appendChild(div);
		        }
	        }
        }
    }
    </script>
    <script type="stylesheet" type="text/css" href="lib.css"></script>
</head>
<body onload="getParams()">
    <div class='header'>
  <h1>Best Library</h1>
  </div>
<div class='top'>
  <button onclick="home()">Home</button>
  <button onclick="Register()">Register</button>
  <button onclick="signIn()">Sign in</button>
  <!--<a href='Authentication.php?sign_out=true'>Sign Out</a>-->
  <button onclick="myBooks()">My Books</button>
</div>
<div id="output">
</div>
<br><br><br><br><br><br><br><br>
<footer class='footer'>
<h2>Best Library | created by Steven Stolp</h2>
 </footer>
</body>
</html>